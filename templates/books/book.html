{% extends "base.html" %}

{% block content %}
    <h3>{{ book.title }}</h3>
    <p>by {{ book.author }}</p>
    <p>Pub. {{ book.pub_year }}</p>

    <h3>Reviews</h3>
    {% if not user_review %}
        <a href="{% url 'books:review_book' book.id %}">Write review</a><br /><br />
        {% if not reviews  %}
        <p>No reviews for this book :</p>
        {% endif %}
    {% else %}
        <h4>Your review:</h4>
        <div style = "margin-left:15px;">
            <b><a href="{% url 'profiles:profile' user.id %}">{{user.username}}</a>: {{ user_review.rating }}/5</b>
            <p>{{ user_review.text }}</p>
            <a href="{% url 'books:edit_review' book.id %}">Edit Review</a>
        </div>
        <br/>
    {% endif %}

    <form id="sort-form" method="GET" action="{% url 'books:view_book' book.id %}">
        <label for="sort">Filter by:</label>
        <select id="sort" name="sort">
            <option value="">No Filter</option>
            <option value="favorable" {% if sort_options == 'favorable' %}selected{% endif %}>Most Favorable</option>
            <option value="unfavorable" {% if sort_options == 'unfavorable' %}selected{% endif %}>Least Favorable</option>
        </select>
    </form>
    <br/>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var sortSelect = document.getElementById('sort');
            var sortOptions = localStorage.getItem('sort_options');
    
            if (sortOptions) {
                sortSelect.value = sortOptions;
            }
    
            sortSelect.addEventListener('change', function() {
                localStorage.setItem('sort_options', this.value);
                document.getElementById('sort-form').submit();
            });
        });
    </script>

    {% for review in reviews %}
        <b><a href="{% url 'profiles:profile' review.user.id %}">{{review.user.username}}</a>: {{ review.rating }}/5</b>
        <p>{{ review.text }}</p>
    {% endfor %}

    <br/>
    <a href="{% url 'books:list_books' %}">Go back</a>

{% endblock %}